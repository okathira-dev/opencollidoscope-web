<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenCollidoscope Web - Interactive Granular Synthesizer</title>
    <link rel="stylesheet" href="src/styles/main.css">
    <link rel="stylesheet" href="src/styles/keyboard.css">
    <link rel="stylesheet" href="src/styles/controls.css">
</head>
<body>
    <div id="app">
        <header class="header">
            <h1>OpenCollidoscope Web</h1>
            <p class="subtitle">Interactive Granular Synthesizer</p>
            <div class="main-controls">
                <button id="start-audio" class="btn btn-primary">Start Audio</button>
                <button id="record-toggle" class="btn btn-secondary">
                    <span class="icon">●</span>
                    <span class="text">Record</span>
                </button>
                <button id="loop-toggle" class="btn btn-secondary">
                    <span class="icon">⟲</span>
                    <span class="text">Loop</span>
                </button>
            </div>
        </header>

        <main class="main-content">
            <!-- Wave Display Section -->
            <section class="wave-section">
                <div class="wave-container">
                    <canvas id="wave-display" width="800" height="200"></canvas>
                    <div class="wave-controls">
                        <div class="selection-controls">
                            <button id="selection-left" class="btn btn-small">◀ Start</button>
                            <span id="selection-info">Selection: 0-100 chunks</span>
                            <button id="selection-right" class="btn btn-small">End ▶</button>
                        </div>
                        <div class="selection-size-controls">
                            <button id="selection-smaller" class="btn btn-small">- Size</button>
                            <button id="selection-larger" class="btn btn-small">+ Size</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Oscilloscope Section -->
            <section class="oscilloscope-section">
                <h3>Audio Output</h3>
                <canvas id="oscilloscope" width="400" height="150"></canvas>
            </section>

            <!-- Piano Keyboard Section -->
            <section class="keyboard-section">
                <h3>Piano Keyboard</h3>
                <div id="piano-keyboard" class="piano-keyboard">
                    <!-- Piano keys will be generated by JavaScript -->
                </div>
                <div class="keyboard-info">
                    <p>Computer Keyboard: <span class="key-mapping">A S D F G H J K L</span> (white keys) | <span class="key-mapping">W E T Y U O P</span> (black keys)</p>
                    <p>Or click the keys above</p>
                </div>
            </section>

            <!-- Granular Controls Section -->
            <section class="controls-section">
                <h3>Granular Parameters</h3>
                <div class="granular-controls">
                    <div class="control-group">
                        <label for="grain-size">Selection Size</label>
                        <input type="range" id="grain-size" min="1" max="127" value="64" class="slider">
                        <span class="value-display">64</span>
                    </div>
                    <div class="control-group">
                        <label for="grain-duration">Grain Duration</label>
                        <input type="range" id="grain-duration" min="1" max="8" value="1" step="0.1" class="slider">
                        <span class="value-display">1.0</span>
                    </div>
                    <div class="control-group">
                        <label for="filter-cutoff">Filter Cutoff</label>
                        <input type="range" id="filter-cutoff" min="0" max="127" value="127" class="slider">
                        <span class="value-display">127</span>
                    </div>
                    <div class="control-group">
                        <label for="master-volume">Master Volume</label>
                        <input type="range" id="master-volume" min="0" max="1" value="0.7" step="0.1" class="slider">
                        <span class="value-display">0.7</span>
                    </div>
                </div>
            </section>

            <!-- Sample Management -->
            <section class="samples-section">
                <h3>Audio Samples</h3>
                <div class="sample-controls">
                    <input type="file" id="sample-upload" accept="audio/*" multiple style="display: none;">
                    <label for="sample-upload" class="btn btn-secondary">Upload Samples</label>
                    <button id="clear-samples" class="btn btn-secondary">Clear All</button>
                </div>
                <div id="sample-list" class="sample-list">
                    <!-- Sample items will be added here -->
                </div>
            </section>

            <!-- Status and Info -->
            <section class="status-section">
                <div class="status-info">
                    <p>Status: <span id="audio-status">Not Started</span></p>
                    <p>Recording: <span id="recording-status">Ready</span></p>
                    <p>Active Grains: <span id="grain-count">0</span></p>
                </div>
            </section>
        </main>

        <!-- Info Modal -->
        <div id="info-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>About OpenCollidoscope Web</h2>
                <p>A web implementation of the original OpenCollidoscope granular synthesizer created by Ben Bengler and Fiore Martin at Queen Mary University of London.</p>
                <h3>How to Use:</h3>
                <ul>
                    <li>1. Click "Start Audio" to initialize the Web Audio API</li>
                    <li>2. Record audio by clicking the Record button</li>
                    <li>3. Adjust the selection area with the arrow buttons</li>
                    <li>4. Play notes using your computer keyboard or clicking the piano keys</li>
                    <li>5. Experiment with granular parameters for different sounds</li>
                </ul>
            </div>
        </div>

        <button id="info-button" class="info-button">?</button>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>